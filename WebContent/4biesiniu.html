<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>憋死牛</title>
<style type="text/css">
</style>
</head>
<body style="text-align: center; background-color: #00bcd4;">
	<h1>
		憋死牛</br>将一方憋住无路可走，即赢
	</h1>
	<canvas id="myCanvas" width="900" height="900"
		style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
		</canvas>
</body>
<script src="common/fastclick.js"></script>
<script type="text/javascript">
	window.addEventListener("load", function() {
		FastClick.attach(document.body);
	}, false);
	var _current = "white";//当前棋子
	var tempi;//被选中的棋子
	var chessBoard = [];//所有棋子
	chessBoard[0] = [ 0, 450, 450 ];
	chessBoard[1] = [ "white", 120, 120 ];
	chessBoard[2] = [ "black", 780, 120 ];
	chessBoard[3] = [ "black", 120, 780 ];
	chessBoard[4] = [ "white", 780, 780 ];

	var canvas = document.getElementById("myCanvas");
	var context = canvas.getContext("2d");
	context.lineWidth = 3;//线条的宽度
	window.onload = function() {
		drawChessBoard(); // 画棋盘
		drawChess();// 画棋子
	}
	canvas.onclick = function(e) {
		var x = e.offsetX;
		var y = e.offsetY;
		for (var i = 0; i < 5; i++) {

			if (Math.pow(x - chessBoard[i][1], 2)
					+ Math.pow(y - chessBoard[i][2], 2) < 8100) {
				// 棋子被选中
				if (chessBoard[i][0] != 0 && _current == chessBoard[i][0]) {
					drawChessBoard();
					drawChess();
					drawChessIsSelected(i);
				}
				// 棋子移动
				if (chessBoard[i][0] == 0
						&& _current == chessBoard[tempi][0]
						&& (i == 0 || (i == 1 && tempi != 4)
								|| (i == 2 && (tempi == 1 || tempi == 0))
								|| (i == 3 && tempi != 2) || (i == 4 && (tempi == 3 || tempi == 0)))) {

					chessBoard[i][0] = chessBoard[tempi][0];
					chessBoard[tempi][0] = 0;
					drawChessBoard();
					drawChess();
					drawChessIsSelected(tempi);
					drawChessIsSelected(i);
					if ((chessBoard[2][0] == 0 && chessBoard[3][0] == chessBoard[4][0])
							|| (chessBoard[4][0] == 0 && chessBoard[1][0] == chessBoard[2][0])) {
						setTimeout(
								function() {
									if (confirm(_current == "white" ? "黑赢，是否重新开始？"
											: "白赢，是否重新开始？")) {
										location.reload();
									} else {
										_current = 0;
									}
								}, 100);
					}
					_current == "white" ? _current = "black"
							: _current = "white";
				}
			}
		}
	}
	// 绘画棋盘
	var drawChessBoard = function() {
		context.clearRect(0, 0, canvas.width, canvas.height);
		context.beginPath();
		context.lineWidth = 15;//线条的宽度
		context.strokeStyle = "red";
		context.arc(780, 450, 75, 0,
				2 * Math.PI);// 画圆
		context.stroke();
		context.closePath();
		context.beginPath();
		context.lineWidth = 3;//线条的宽度
		context.strokeStyle = "black";
		for (var i = 0; i < 2; i++) {
			context.moveTo(120, 120 + i * 660);
			context.lineTo(780, 120 + i * 660);
			context.stroke();
		}
		context.moveTo(120, 120);
		context.lineTo(120, 780);
		context.stroke();
		context.moveTo(120, 780);
		context.lineTo(780, 120);
		context.stroke();
		context.moveTo(120, 120);
		context.lineTo(780, 780);
		context.stroke();
	}
	// 画棋子
	var drawChess = function() {
		for (var i = 0; i < 5; i++) {
			if (chessBoard[i][0] != 0) {
				context.beginPath();
				context.arc(chessBoard[i][1], chessBoard[i][2], 90, 0,
						2 * Math.PI);// 画圆
				context.closePath();
				//渐变
				var gradient = context.createRadialGradient(
						chessBoard[i][1] + 2, chessBoard[i][2] - 2, 90,
						chessBoard[i][1] + 2, chessBoard[i][2] - 2, 0);
				if ("black" == chessBoard[i][0]) {
					gradient.addColorStop(0, '#0a0a0a');
					gradient.addColorStop(1, '#636766');
				} else {
					gradient.addColorStop(0, '#d1d1d1');
					gradient.addColorStop(1, '#f9f9f9');
				}
				context.fillStyle = gradient;
				context.fill();
			}

		}
	}
	// 画棋子被选中效果
	var drawChessIsSelected = function(i) {
		tempi = i;
		context.beginPath();
		context.strokeStyle = "green";
		context.arc(chessBoard[i][1], chessBoard[i][2], 90, 0, 2 * Math.PI);// 画圆
		context.lineWidth = 5;//线条的宽度
		context.closePath();
		context.stroke();
	}
</script>
</html>